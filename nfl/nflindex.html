<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NFL ‚Äî Week View</title>
  <style>
    :root{
      --bg:#0B162A; --panel:#1E2A47; --panel2:#2B3A67; --ink:#fff;
      --gold:#FFD700; --muted:#a8b3cf; --line:#333;
      --bk:#2d3f73; --bk-ink:#00FFB0; --md:#26355a; --md-ink:#FFB347;
      --accent:#FF3C00;
    }
    *{box-sizing:border-box}
    body{background:var(--bg);color:var(--ink);font-family:'Segoe UI',system-ui,Arial,sans-serif;padding:2rem 1rem;line-height:1.45}
    header{display:flex;flex-direction:column;gap:.25rem;align-items:center;margin-bottom:1rem}
    h1{color:var(--accent);margin:0 0 .25rem;font-size:clamp(1.4rem,2.2vw,2rem);text-align:center}
    .sub{color:var(--muted);font-size:.95rem;text-align:center}
    nav{margin:1rem 0 1.25rem;text-align:center}
    nav a{color:var(--gold);text-decoration:none;font-weight:600}
    nav a:hover{text-decoration:underline}
    .wrap{max-width:1150px;margin:0 auto}
    .game{background:var(--panel);border-radius:10px;overflow:hidden;margin:16px 0;box-shadow:0 4px 12px rgba(0,0,0,.35)}
    .hdr{background:var(--accent);color:#fff;padding:.5rem 1rem;font-weight:700;display:flex;justify-content:space-between}
    .kick{opacity:.95}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid var(--line);padding:.65rem .8rem;text-align:center;vertical-align:middle}
    th{background:var(--panel2);color:var(--gold);font-weight:700}
    td:first-child, th:first-child { width: 100px; }
    tr.bk{background:var(--bk);color:var(--bk-ink)}
    tr.md{background:var(--md);color:var(--md-ink)}
    .src{font-weight:800;letter-spacing:.3px;white-space:nowrap}
    .note{padding:.35rem 1rem;color:var(--muted);font-size:.9rem}
    .empty{opacity:.6}
    .weeks{margin:0 auto 1rem;max-width:1150px}
    .weeks a{color:#d7e9ff;margin-right:.75rem;text-decoration:none}
    .weeks a:hover{text-decoration:underline}
    .player-panel{background:var(--panel2);padding:.5rem 1rem;margin:.5rem;border-radius:8px;font-size:.9rem}
    .player-panel h4{margin:.2rem 0;color:var(--gold)}
    .player-panel ul{list-style:none;padding-left:0;margin:0}
    .player-panel li{margin:.2rem 0}
  </style>
</head>
<body>
  <header>
    <h1>üèà NFL ‚Äî Week View</h1>
    <div class="sub" id="weekLine">Loading‚Ä¶</div>
  </header>

  <nav>
    <a href="../index.html">üè† Home</a> &nbsp;‚Ä¢&nbsp;
    <a href="../value.html">üí∞ Value</a>
  </nav>

  <div class="weeks" id="weeksList"></div>

  <div class="wrap" id="root">
    <div class="note">Loading fixtures‚Ä¶</div>
  </div>

  <script>
  const fmt2 = x => (x===null||x===undefined||x==='') ? '' : Number(x).toFixed(2);
  const fmt1 = x => (x===null||x===undefined||x==='') ? '' : Number(x).toFixed(1);

  function buildGame(g){
    const container = document.createElement('div');
    container.className = 'game';

    const hdr = document.createElement('div');
    hdr.className = 'hdr';
    hdr.innerHTML = `<div>${g.away} @ ${g.home}</div><div class="kick">${g.kickoff_local||''}</div>`;
    container.appendChild(hdr);

    const tbl = document.createElement('table');
    const thead = document.createElement('thead');
    thead.innerHTML = `
      <tr>
        <th>Source</th>
        <th>${g.home}</th>
        <th>${g.away}</th>
        <th>Moneyline</th>
        <th>Spread</th>
        <th>Total</th>
      </tr>`;
    tbl.appendChild(thead);

    const mkRow = (srcClass, srcLabel, line) => {
      const tr = document.createElement('tr');
      tr.className = srcClass;
      const hScore = (line.home_score ?? '');
      const aScore = (line.away_score ?? '');
      tr.innerHTML = `
        <td class="src">${srcLabel}</td>
        <td class="hcell">${hScore}</td>
        <td class="acell">${aScore}</td>
        <td>${fmt2(line.ml_home)} / ${fmt2(line.ml_away)}</td>
        <td>${fmt1(line.spread)}</td>
        <td>${fmt1(line.total)}</td>
      `;
      return tr;
    };

    const tbody = document.createElement('tbody');
    tbody.appendChild(mkRow('bk', 'Bookmaker', g.book||{}));
    tbody.appendChild(mkRow('md', 'Model',     g.model||{}));
    tbl.appendChild(tbody);
    container.appendChild(tbl);

    // ---- Player Panel ----
    if ((g.top_td_scorers && g.top_td_scorers.length) ||
        (g.top_rusher && g.top_rusher.length) ||
        (g.top_receiver && g.top_receiver.length)) {

      const panel = document.createElement('div');
      panel.className = 'player-panel';
      let html = '<h4>Key Player Predictions</h4><ul>';

      if (g.top_td_scorers && g.top_td_scorers.length){
        const tds = g.top_td_scorers.map(p =>
          `${p.player_name} [${p.team}] (${(p.prob_anytime_td*100).toFixed(0)}%, ${fmt2(p.fair_odds)})`
        ).join(', ');

        html += `<li>üî• TD Scorers: ${tds}</li>`;
      }

      if (g.top_rusher && g.top_rusher.length){
        const r = g.top_rusher[0];
        html += `<li>üèÉ Rushing: ${r.player_name} (${fmt1(r.rush_yards)} yds)</li>`;
      }

      if (g.top_receiver && g.top_receiver.length){
        const r = g.top_receiver[0];
        html += `<li>üéØ Receiving: ${r.player_name} (${fmt1(r.rec_yards)} yds)</li>`;
      }

      html += '</ul>';
      panel.innerHTML = html;
      container.appendChild(panel);
    }

    return container;
  }

  fetch('nfl_week.json')
    .then(r=>r.json())
    .then(data=>{
      document.getElementById('weekLine').textContent =
        data?.title ? data.title : (data?.week ? `Week ${data.week}` : 'Week');
      const wl = document.getElementById('weeksList');
      const weeks = (data?.weeks||[]);
      if (weeks.length){
        wl.innerHTML = 'Weeks: ' + weeks.map(w => `<a href="week${w}.html">Week ${w}</a>`).join('');
      }
      const root = document.getElementById('root');
      root.innerHTML = '';
      const fixtures = (data?.fixtures||[]);
      if (!fixtures.length){
        root.innerHTML = '<div class="note empty">No fixtures.</div>';
        return;
      }
      fixtures.forEach(g => root.appendChild(buildGame(g)));
    })
    .catch(e=>{
      document.getElementById('root').innerHTML =
        `<div class="note">Could not load <code>nfl_week.json</code><br/><span class="empty">${e}</span></div>`;
    });
  </script>
</body>
</html>
